<!doctype html>
<html class="no-js" lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>
    
  [è¯‘] Sequelize(2)  å®šä¹‰è¡¨æ ¼ - å‡ è°· åšå®¢
  
  </title>
  
  
  <link href="atom.xml" rel="alternate" title="å‡ è°· åšå®¢" type="application/atom+xml">
    <link rel="stylesheet" href="asset/css/foundation.min.css" />
    <link rel="stylesheet" href="asset/css/docs.css" />
    <script src="asset/js/vendor/modernizr.js"></script>
    <script src="asset/js/vendor/jquery.js"></script>
  <script src="asset/highlightjs/highlight.pack.js"></script>
  <link href="asset/highlightjs/styles/github.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script>hljs.initHighlightingOnLoad();</script>
<script type="text/javascript">
  function before_search(){
    var searchVal = 'site:kayorl.com ' + document.getElementById('search_input').value;
    document.getElementById('search_q').value = searchVal;
    return true;
  }
</script>
  </head>
  <body class="antialiased hide-extras">
    
    <div class="marketing off-canvas-wrap" data-offcanvas>
      <div class="inner-wrap">


<nav class="top-bar docs-bar hide-for-small" data-topbar>


  <section class="top-bar-section">
  <div class="row">
      <div style="position: relative;width:100%;"><div style="position: absolute; width:100%;">
        <ul id="main-menu" class="left">
        
        <li id=""><a target="_self" href="index.html">Home</a></li>
        
        <li id=""><a target="_self" href="archives.html">Archives</a></li>
        
        <li id=""><a target="_self" href="about.html">About</a></li>
        
        </ul>

        <ul class="right" id="search-wrap">
          <li>
<form target="_blank" onsubmit="return before_search();" action="http://google.com/search" method="get">
    <input type="hidden" id="search_q" name="q" value="" />
    <input tabindex="1" type="search" id="search_input"  placeholder="Search"/>
</form>
</li>
          </ul>
      </div></div>
  </div>
  </section>

</nav>

        <nav class="tab-bar show-for-small">
  <a href="javascript:void(0)" class="left-off-canvas-toggle menu-icon">
    <span> &nbsp; å‡ è°· åšå®¢</span>
  </a>
</nav>

<aside class="left-off-canvas-menu">
      <ul class="off-canvas-list">
       
       <li><a href="index.html">HOME</a></li>
    <li><a href="archives.html">Archives</a></li>
    <li><a href="about.html">ABOUT</a></li>

    <li><label>Categories</label></li>

        
            <li><a href="nodejs.html">nodejs</a></li>
        
            <li><a href="database.html">æ•°æ®åº“ç³»ç»Ÿ</a></li>
        
            <li><a href="C&C++.html">C/C++</a></li>
        
            <li><a href="O&M.html">è¿ç»´</a></li>
        
            <li><a href="objc.html">ObjC</a></li>
         

      </ul>
    </aside>

<a class="exit-off-canvas" href="#"></a>


        <section id="main-content" role="main" class="scroll-container">
        
       

 <script type="text/javascript">
  $(function(){
    $('#menu_item_index').addClass('is_active');
  });
</script>
<div class="row">
  <div class="large-8 medium-8 columns">
      <div class="markdown-body article-wrap">
       <div class="article">
          
          <h1>[è¯‘] Sequelize(2)  å®šä¹‰è¡¨æ ¼</h1>
     
        <div class="read-more clearfix">
          <span class="date">2016/9/29 16:17 ä¸‹åˆ</span>

          <span>posted in&nbsp;</span> 
          
              <span class="posted-in"><a href='sequelize.html'>Sequelize</a></span>
           
         
          <span class="comments">
            
              <a href="http://kayorl.com/14872314142360.html#disqus_thread">comments</a>
            

            
              &nbsp;<a  class="ds-thread-count" data-thread-key="14872314142360.html" data-count-type="comments" href="14872314142360.html#ds-thread"></a>
            
          </span>

        </div>
      </div><!-- article -->

      <div class="article-content">
      <p>Sequelize ä¼šè‡ªåŠ¨å¢åŠ  <code>createdAt</code> å’Œ <code>updated</code> å±æ€§,è¿™æ ·èƒ½çŸ¥é“ä¸€ä¸ªå®ä¾‹çš„åˆ›å»ºæ—¶é—´å’Œæœ€ç»ˆä¿®æ”¹æ—¶é—´.</p>

<p>å¦‚æœä¸æƒ³è‡ªåŠ¨ç”Ÿæˆ,å¯ä»¥åˆ°<a href="http://docs.sequelizejs.com/en/v3/docs/models-definition/#configuration">configuration</a>å»çœ‹å¦‚ä½•å®ç°.</p>

<span id="more"></span><!-- more -->

<blockquote>
<p>å®šä¹‰æ¨¡å‹ä¸è¡¨ä¹‹é—´çš„æ˜ å°„,ä½¿ç”¨ define æ–¹æ³•. </p>
</blockquote>

<pre><code class="language-js">var Project = sequelize.define(&#39;project&#39;, {
  title: Sequelize.STRING,
  description: Sequelize.TEXT
})

var Task = sequelize.define(&#39;task&#39;, {
  title: Sequelize.STRING,
  description: Sequelize.TEXT,
  deadline: Sequelize.DATE
})
</code></pre>

<p>è¿˜å¯ä»¥ä¸ºæ¯ä¸€ä¸ªåˆ—å¢åŠ ä¸€äº›å¯é€‰å±æ€§</p>

<pre><code class="language-js">var Foo = sequelize.define(&#39;foo&#39;, {
 // è‡ªåŠ¨è®¾ç½®é»˜è®¤å€¼ä¸º true
 flag: { type: Sequelize.BOOLEAN, allowNull: false, defaultValue: true},

 //  æ—¥æœŸé»˜è®¤å€¼ =&gt; å½“å‰æ—¶é—´
 myDate: { type: Sequelize.DATE, defaultValue: Sequelize.NOW },

 // è®¾ç½®åˆ—çš„ allowNullä¸º false å°†ä¼šä¸ºè¯¥åˆ—å¢åŠ  éç©º å±æ€§
 // åœ¨æŸ¥è¯¢æ•°æ®åº“ä¹‹å‰æƒ³æ£€è½¦ä¸€ä¸ªå€¼æ˜¯å¦ä¸º ç©º ,çœ‹ validation èŠ‚
 title: { type: Sequelize.STRING, allowNull: false},
 
 // åˆ›å»ºä¸¤ä¸ªæ‹¥æœ‰ç›¸åŒå±æ€§çš„å€¼ä¼šæŠ›å‡ºä¸€ä¸ªé”™è¯¯
 // The unique property can be either a boolean, or a string.
 // If you provide the same string for multiple columns, they will form a
 // composite unique key.
 someUnique: {type: Sequelize.STRING, unique: true},
 uniqueOne: { type: Sequelize.STRING,  unique: &#39;compositeIndex&#39;},
 uniqueTwo: { type: Sequelize.INTEGER, unique: &#39;compositeIndex&#39;}
 
 // unique å±æ€§åŒæ—¶ä¹Ÿæ˜¯åˆ›å»ºä¸€ä¸ª unique ç´¢å¼• çš„ç®€å†™
 someUnique: {type: Sequelize.STRING, unique: true}
 
 // è·Ÿä¸‹é¢çš„ä¸¤å¥å®šä¹‰è¯­å¥ç­‰ä»·
 {someUnique: {type: Sequelize.STRING}},
 {indexes: [{unique: true, fields: [&#39;someUnique&#39;]}]}

 // ä¸»ç 
 identifier: { type: Sequelize.STRING, primaryKey: true},
 
 // è‡ªå¢
 incrementMe: { type: Sequelize.INTEGER, autoIncrement: true },

 // æ³¨é‡Š,åªæœ‰ MySQL å’Œ PG å¯ä»¥ä½¿ç”¨
 // Comments can be specified for each field for MySQL and PG
 hasComment: { type: Sequelize.INTEGER, comment: &quot;I&#39;m a comment!&quot; },
 
 // åœ¨æ¨¡å‹ä¸­çš„åå­—æ˜¯å°é©¼å³°,åœ¨è¡¨ä¸­çš„åˆ—åå¯ä»¥ç”¨ field å±æ€§æ¥æŒ‡å®š
 fieldWithUnderscores: { type: Sequelize.STRING, field: &quot;field_with_underscores&quot; },

 // åˆ›å»ºå¤–ç 
 bar_id: {
   type: Sequelize.INTEGER,

   references: {
     // This is a reference to another model
     model: Bar,
     //è¢«å¼•ç”¨æ¨¡å‹çš„  åˆ—å  (æ˜¯åˆ—å,å³ field å)
     key: &#39;id&#39;,
     // æ£€æŸ¥å¤–ç çº¦æŸ,åªæ”¯æŒ PostgreSQL .
     deferrable: Sequelize.Deferrable.INITIALLY_IMMEDIATE
   }
 }
})
</code></pre>

<h2 id="toc_0">æ•°æ®ç±»å‹</h2>

<p>æ›´è¯¦ç»†çš„å¯ä»¥ä¸Š <a href="http://docs.sequelizejs.com/en/v3/api/datatypes">DataTypes</a> çœ‹ä¸€çœ‹</p>

<pre><code class="language-js">Sequelize.STRING                      // VARCHAR(255)
Sequelize.STRING(1234)                // VARCHAR(1234)
Sequelize.STRING.BINARY               // VARCHAR BINARY
Sequelize.TEXT                        // TEXT
Sequelize.TEXT(&#39;tiny&#39;)                // TINYTEXT

Sequelize.INTEGER                     // INTEGER
Sequelize.BIGINT                      // BIGINT
Sequelize.BIGINT(11)                  // BIGINT(11)

Sequelize.FLOAT                       // FLOAT
Sequelize.FLOAT(11)                   // FLOAT(11)
Sequelize.FLOAT(11, 12)               // FLOAT(11,12)

Sequelize.REAL                        // REAL        PostgreSQL only.
Sequelize.REAL(11)                    // REAL(11)    PostgreSQL only.
Sequelize.REAL(11, 12)                // REAL(11,12) PostgreSQL only.

Sequelize.DOUBLE                      // DOUBLE
Sequelize.DOUBLE(11)                  // DOUBLE(11)
Sequelize.DOUBLE(11, 12)              // DOUBLE(11,12)

Sequelize.DECIMAL                     // DECIMAL
Sequelize.DECIMAL(10, 2)              // DECIMAL(10,2)

Sequelize.DATE                        // DATETIME for mysql / sqlite, TIMESTAMP WITH TIME ZONE for postgres
Sequelize.DATE(6)                     // DATETIME(6) for mysql 5.6.4+. Fractional seconds support with up to 6 digits of precision 
Sequelize.DATEONLY                    // DATE without time.
Sequelize.BOOLEAN                     // TINYINT(1)

Sequelize.ENUM(&#39;value 1&#39;, &#39;value 2&#39;)  // An ENUM with allowed values &#39;value 1&#39; and &#39;value 2&#39;
Sequelize.ARRAY(Sequelize.TEXT)       // Defines an array. PostgreSQL only.

Sequelize.JSON                        // JSON column. PostgreSQL only.
Sequelize.JSONB                       // JSONB column. PostgreSQL only.

Sequelize.BLOB                        // BLOB (bytea for PostgreSQL)
Sequelize.BLOB(&#39;tiny&#39;)                // TINYBLOB (bytea for PostgreSQL. Other options are medium and long)

Sequelize.UUID                        // UUID datatype for PostgreSQL and SQLite, CHAR(36) BINARY for MySQL (use defaultValue: Sequelize.UUIDV1 or Sequelize.UUIDV4 to make sequelize generate the ids automatically)


Sequelize.GEOMETRY                    // Spatial column.  PostgreSQL (with PostGIS) or MySQL only.
Sequelize.GEOMETRY(&#39;POINT&#39;)           // Spatial column with geomerty type.  PostgreSQL (with PostGIS) or MySQL only.
Sequelize.GEOMETRY(&#39;POINT&#39;, 4326)     // Spatial column with geomerty type and SRID.  PostgreSQL (with PostGIS) or MySQL only.
</code></pre>

<p>integer, bigint, float å’Œ double åŒæ ·æ”¯æŒ unsigned å’Œ zerofill çº¦æŸ   </p>

<pre><code class="language-js">Sequelize.INTEGER.UNSIGNED              // INTEGER UNSIGNED
Sequelize.INTEGER(11).UNSIGNED          // INTEGER(11) UNSIGNED
Sequelize.INTEGER(11).ZEROFILL          // INTEGER(11) ZEROFILL
Sequelize.INTEGER(11).ZEROFILL.UNSIGNED // INTEGER(11) UNSIGNED ZEROFILL
Sequelize.INTEGER(11).UNSIGNED.ZEROFILL // INTEGER(11) UNSIGNED ZEROFILL
</code></pre>

<h3 id="toc_1">å¯¹è±¡æ ‡è®°çš„ç”¨æ³•</h3>

<pre><code class="language-js">// for enums:
sequelize.define(&#39;model&#39;, {
  states: {
    type:   Sequelize.ENUM,
    values: [&#39;active&#39;, &#39;pending&#39;, &#39;deleted&#39;]
  }
})
</code></pre>

<hr/>

<h2 id="toc_2">Getters &amp; Setters æ–¹æ³•</h2>

<p>åœ¨æ¨¡å‹ä¸­å®šä¹‰&#39;å¯¹è±¡-å±æ€§&#39;çš„ getter å’Œ  setter æ–¹æ³•æ˜¯å¯èƒ½çš„,å¯ä»¥è¢«ç”¨æ¥ä¿æŠ¤ä¸æ•°æ®åº“åˆ—ç›¸æ˜ å°„çš„å±æ€§,è¿˜å¯ä»¥å®šä¹‰ä¸€äº›<code>å‡</code>å±æ€§<br/>
Getters å’Œ Setters èƒ½ä»¥ä¸‹é¢ä¸¤ç§æ–¹å¼å®šä¹‰</p>

<ul>
<li>ä½œä¸ºå•ä¸ªå±æ€§å®šä¹‰çš„ä¸€éƒ¨åˆ†</li>
<li>ä½œä¸ºæ¨¡å‹å¯é€‰çš„ä¸€éƒ¨åˆ†</li>
</ul>

<h2 id="toc_3">å®šä¹‰ä¸ºå±æ€§çš„ä¸€éƒ¨åˆ†</h2>

<pre><code class="language-js">var Employee = sequelize.define(&#39;employee&#39;, {
  name:  {
    type     : Sequelize.STRING,
    allowNull: false,
    get      : function()  {
      var title = this.getDataValue(&#39;title&#39;);
      // &#39;this&#39; å…è®¸ä½ å»è·å¾—å®ä¾‹çš„å±æ€§
      return this.getDataValue(&#39;name&#39;) + &#39; (&#39; + title + &#39;)&#39;;
    },
  },
  title: {
    type     : Sequelize.STRING,
    allowNull: false,
    set      : function(val) {
      this.setDataValue(&#39;title&#39;, val.toUpperCase());
    }
  }
});

Employee
  .create({ name: &#39;John Doe&#39;, title: &#39;senior engineer&#39; })
  .then(function(employee) {
    console.log(employee.get(&#39;name&#39;)); // John Doe (SENIOR ENGINEER)
    console.log(employee.get(&#39;title&#39;)); // SENIOR ENGINEER
  })
</code></pre>

<h4 id="toc_4">å®šä¹‰ä¸ºæ¨¡å‹çš„ä¸€éƒ¨åˆ†</h4>

<p>ä¸‹é¢æ˜¯ä¸€ä¸ªåœ¨æ¨¡å‹å†…å®šä¹‰ getter å’Œ setter æ–¹æ³•çš„ä¾‹å­. åœ¨è¿™ä¸ªä¾‹å­é‡Œ,<code>fullname</code> çš„ getter æ–¹æ³•æ˜¯åœ¨æ¨¡å‹å†…å®šä¹‰<code>å‡å±æ€§</code>çš„ä¸€ä¸ªä¾‹å­<br/>
,å› ä¸º <code>fullname</code>  å±æ€§ä¸å­˜åœ¨äºæ•°æ®åº“æ¨¡å¼ä¸­. å®é™…ä¸Š,å‡å±æ€§å¯ä»¥é€šè¿‡ä»¥ä¸‹ä¸¤ç§æ–¹å¼æ¥å®šä¹‰</p>

<ul>
<li>é€šè¿‡æ¨¡å‹çš„ getter æ–¹æ³•</li>
<li>æˆ–è€…é€šè¿‡ä½¿ç”¨å¸¦æœ‰ <a href="http://docs.sequelizejs.com/en/v3/api/datatypes#virtual"><code>VIRTUAL</code></a> æ•°æ®ç±»å‹çš„åˆ—, VIRTUAL æ•°æ®ç±»å‹å¯ä»¥æœ‰ validation , ç„¶è€Œ virtual æ•°æ®ç±»å‹çš„ getter æ–¹æ³•ä¸è¡Œ</li>
</ul>

<p>æ³¨æ„åœ¨ <code>fullName</code> çš„ getter æ–¹æ³•ä¸­å¼•ç”¨çš„ <code>this.firstName</code> å’Œ <code>this.lastName</code> ä¼šè§¦å‘å„è‡ªçš„ getter æ–¹æ³•</p>

<pre><code class="language-js">var Foo = sequelize.define(&#39;foo&#39;, {
  firstname: Sequelize.STRING,
  lastname: Sequelize.STRING
}, {
  getterMethods   : {
    fullName       : function()  { return this.firstname + &#39; &#39; + this.lastname }
  },
  
  setterMethods   : {
    fullName       : function(value) {
        var names = value.split(&#39; &#39;);
        this.setDataValue(&#39;firstname&#39;, names.slice(0, -1).join(&#39; &#39;));
        this.setDataValue(&#39;lastname&#39;, names.slice(-1).join(&#39; &#39;));
    },
  }
});

</code></pre>

<h4 id="toc_5">åœ¨ getter å’Œ setter æ–¹æ³•ä¸­ä½¿ç”¨çš„ Helper æ–¹æ³•</h4>

<ul>
<li>è·å–ä¸€ä¸ªåŸºç¡€å±æ€§å€¼ , ç»å¸¸ç”¨ <code>this.getDataValue()</code></li>
<li>è®¾ç½®ä¸€ä¸ªåŸºç¡€å±æ€§å€¼ , ç»å¸¸ç”¨ <code>this.setDataValue()</code></li>
<li>åšæŒä½¿ç”¨ getter å’Œ setter æ–¹æ³• å¯ä»¥ä¿æŠ¤å†…éƒ¨æ•°æ®</li>
</ul>

<pre><code class="language-js">/* &#39;title&#39; å±æ€§çš„ getter æ–¹æ³•*/
function(){
    return this.getDataValue(&#39;title&#39;);
}

/* &#39;title&#39; å±æ€§çš„ setter æ–¹æ³•*/
function(){
    return this.setDataValue(&#39;title&#39;,title.toString().toLowerCase());
}
</code></pre>

<h2 id="toc_6">è®¤è¯ (Validation)</h2>

<p>æ¨¡å‹è®¤è¯, å¯ä»¥è§„å®šæ¨¡å‹ä¸­æ¯ä¸ªå±æ€§çš„æ ¼å¼/å†…å®¹ çš„è®¤è¯. å…¶å®ç°åœ¨<a href="https://github.com/chriso/validator.js">è¿™</a></p>

<p>å½“è¿›è¡Œ <code>create</code>,<code>update</code> å’Œ <code>save</code>æ“ä½œæ—¶,è®¤è¯ä¼šè‡ªåŠ¨è¿è¡Œ.ä¹Ÿå¯ä»¥åœ¨å®ä¾‹ä¸­æ‰‹åŠ¨è®¤è¯</p>

<pre><code class="language-js">var ValidateMe = sequelize.define(&#39;foo&#39;, {
  foo: {
    type: Sequelize.STRING,
    validate: {
      is: [&quot;^[a-z]+$&quot;,&#39;i&#39;],     // will only allow letters
      is: /^[a-z]+$/i,          // same as the previous example using real RegExp
      not: [&quot;[a-z]&quot;,&#39;i&#39;],       // will not allow letters
      isEmail: true,            // checks for email format (foo@bar.com)
      isUrl: true,              // checks for url format (http://foo.com)
      isIP: true,               // checks for IPv4 (129.89.23.1) or IPv6 format
      isIPv4: true,             // checks for IPv4 (129.89.23.1)
      isIPv6: true,             // checks for IPv6 format
      isAlpha: true,            // will only allow letters
      isAlphanumeric: true,     // will only allow alphanumeric characters, so &quot;_abc&quot; will fail
      isNumeric: true,          // will only allow numbers
      isInt: true,              // checks for valid integers
      isFloat: true,            // checks for valid floating point numbers
      isDecimal: true,          // checks for any numbers
      isLowercase: true,        // checks for lowercase
      isUppercase: true,        // checks for uppercase
      notNull: true,            // won&#39;t allow null
      isNull: true,             // only allows null
      notEmpty: true,           // don&#39;t allow empty strings
      equals: &#39;specific value&#39;, // only allow a specific value
      contains: &#39;foo&#39;,          // force specific substrings
      notIn: [[&#39;foo&#39;, &#39;bar&#39;]],  // check the value is not one of these
      isIn: [[&#39;foo&#39;, &#39;bar&#39;]],   // check the value is one of these
      notContains: &#39;bar&#39;,       // don&#39;t allow specific substrings
      len: [2,10],              // only allow values with length between 2 and 10
      isUUID: 4,                // only allow uuids
      isDate: true,             // only allow date strings
      isAfter: &quot;2011-11-05&quot;,    // only allow date strings after a specific date
      isBefore: &quot;2011-11-05&quot;,   // only allow date strings before a specific date
      max: 23,                  // only allow values
      min: 23,                  // only allow values &gt;= 23
      isArray: true,            // only allow arrays
      isCreditCard: true,       // check for valid credit card numbers

      // custom validations are also possible:
      isEven: function(value) {
        if(parseInt(value) % 2 != 0) {
          throw new Error(&#39;Only even values are allowed!&#39;)
        // we also are in the model&#39;s context here, so this.otherField
        // would get the value of otherField if it existed
        }
      }
    }
  }
});
</code></pre>

<p>æ³¨æ„å½“å¤šä¸ªå‚æ•°éœ€è¦è¢«ä¼ é€’åˆ°å†…åµŒçš„è®¤è¯å‡½æ•°æ—¶,å¤šä¸ªå‚æ•°åº”è¯¥è¢«æ”¾åœ¨ä¸€ä¸ªæ•°ç»„ä¸­.</p>

<pre><code class="language-js">isIn: [[&#39;en&#39;, &#39;zh&#39;]],   // check the value is one of these
</code></pre>

<p>ä¸ç”¨ validator.js æä¾›çš„é”™è¯¯ä¿¡æ¯,è‡ªå·±å®šåˆ¶é”™è¯¯ä¿¡æ¯</p>

<pre><code class="language-js">isIn: {
  args: [[&#39;en&#39;, &#39;zh&#39;]],
  msg: &quot;Must be English or Chinese&quot;
}
</code></pre>

<p>å¯ä»¥çœ‹<a href="https://github.com/chriso/validator.js">validator.js PROJECT</a>è·å–æ›´å¤šç»†èŠ‚</p>

<hr/>

<h3 id="toc_7">è®¤è¯å™¨å’Œ <code>allowNull</code></h3>

<p>å¦‚æœæ¨¡å‹çš„åˆ—è¢«è®¾ç½®ä¸º <code>allowNull:true</code> å’Œ å€¼è¢«è®¾ç½®ä¸º <code>null</code>çš„è¯,é‚£è®¤è¯å™¨ä¸ä¼šè¿è¡Œ.</p>

<p>ä¸¾ä¸ªæ —å­, ä¸€ä¸ªå­—ç¬¦ä¸²çš„åˆ—é•¿åº¦è®¾ç½®ä¸º æœ€çŸ­ä¸º5, ä½†å®ƒå¯ä»¥å­˜å‚¨ null</p>

<h3 id="toc_8">æ¨¡å‹è®¤è¯</h3>

<pre><code class="language-js">var Pub = Sequelize.define(&#39;pub&#39;, {
  name: { type: Sequelize.STRING },
  address: { type: Sequelize.STRING },
  latitude: {
    type: Sequelize.INTEGER,
    allowNull: true,
    defaultValue: null,
    validate: { min: -90, max: 90 }
  },
  longitude: {
    type: Sequelize.INTEGER,
    allowNull: true,
    defaultValue: null,
    validate: { min: -180, max: 180 }
  },
}, {


  //åœ¨è¿™é‡Œå¯¹æ¨¡å‹è¿›è¡ŒéªŒè¯,åªæœ‰ latitude å’Œ longtitude åŒæ—¶è¢«ç»™äºˆæˆ–éƒ½ä¸ºç©ºæ—¶æˆç«‹
  validate: {
    bothCoordsOrNone: function() {
      if ((this.latitude === null) !== (this.longitude === null)) {
        throw new Error(&#39;Require either both latitude and longitude or neither&#39;)
      }
    }
  }
})
</code></pre>

<hr/>

<h2 id="toc_9">é…ç½®</h2>

<pre><code class="language-js">var Bar = sequelize.define(&#39;bar&#39;, { /* bla */ }, {

  // ä¸å¢åŠ  TIMESTAMP å±æ€§  (updatedAt, createdAt)
  timestamps: false,
  
  //ä¸åˆ é™¤æ•°æ®åº“ä¸­åŸæœ‰é¡¹, å¢åŠ æ–°å±æ€§ deletedAt å¹¶è®¾ç½®ä¸º å½“å‰æ—¥æœŸ,
  //åªæœ‰ TIMESTAMP å±æ€§æ˜¯å…è®¸çš„æ—¶å€™æœ‰æ•ˆ
  paranoid: true,
  
  // ä¸è¦ä½¿ç”¨é©¼å³°å¼è¯­æ³•,ç”¨ä¸‹åˆ’çº¿ä»£æ›¿
  // so updatedAt will be updated_at
  underscored: true,
  
  // ä¸å…è®¸è°ƒæ•´è¡¨å ; 
  // é»˜è®¤åœ°, sequelize ä¼šè‡ªåŠ¨è½¬æ¢æ‰€æœ‰ä¼ é€’çš„æ¨¡å‹åå­—(define çš„ç¬¬ä¸€ä¸ªå‚æ•°)
  // ä¸ºå¤æ•°
  // å¦‚æœä¸æƒ³è¿™æ ·,è®¾ç½®ä¸º true
  freezeTableName: true,

  // å®šä¹‰è¡¨å
  tableName: &#39;my_very_custom_table_name&#39;
})
</code></pre>

<p>ä¿®æ”¹å¼•æ“</p>

<pre><code class="language-js">var Person = sequelize.define(&#39;person&#39;, { /* attributes */ }, {
  engine: &#39;MYISAM&#39;
})

// or globally
var sequelize = new Sequelize(db, user, pw, {
  define: { engine: &#39;MYISAM&#39; }
})
</code></pre>

<p>åšæ³¨é‡Š</p>

<pre><code class="language-js">var Person = sequelize.define(&#39;person&#39;, { /* attributes */ }, {
  comment: &quot;I&#39;m a table comment!&quot;
})
</code></pre>

<hr/>

<h2 id="toc_10">å¯¼å…¥</h2>

<p>å¯ä»¥æŠŠå¯¹è¡¨çš„å®šä¹‰æ”¾åœ¨å•ä¸€æ–‡ä»¶ä¸­,è¿”å›å¯¹è±¡æ°å¥½è·Ÿåœ¨ import æ–¹æ³•ä¸­å®šä¹‰çš„ä¸€æ ·</p>

<pre><code class="language-js">
  // in your server file - e.g. app.js
var Project = sequelize.import(__dirname + &quot;/path/to/models/project&quot;)

  // å®šä¹‰åœ¨ project.js æ–‡ä»¶ä¸­å·²ç»å®šä¹‰å®Œæˆäº†
  // DataTypes  ä¸ä¸Šé¢è§£é‡Šçš„éƒ¨åˆ†å¾ˆåƒ
module.exports = function(sequelize, DataTypes) {
  return sequelize.define(&quot;project&quot;, {
    name: DataTypes.STRING,
    description: DataTypes.TEXT
  })
}

sequelize.import(&#39;project&#39;, function(sequelize, DataTypes) {
  return sequelize.define(&quot;project&quot;, {
    name: DataTypes.STRING,
    description: DataTypes.TEXT
  })
})
</code></pre>

<h2 id="toc_11">æ•°æ®åº“åŒæ­¥</h2>

<p>å¼€å§‹ä¸€ä¸ªæ–°é¡¹ç›®çš„æ—¶å€™,æˆ‘ä»¬æ²¡æœ‰æ•°æ®åº“æ¶æ„,äºæ˜¯æˆ‘ä»¬ä¸éœ€è¦ Sequelize.</p>

<p>åªéœ€è¦è¯´æ˜æˆ‘ä»¬çš„æ¨¡å‹ç»“æ„, è®©åº“åšå‰©ä¸‹çš„éƒ¨åˆ†,ç°åœ¨åªæ”¯æŒ <code>è¡¨çš„åˆ›å»ºä¸åˆ é™¤</code></p>

<pre><code class="language-js">// åªåŒæ­¥è¿˜æ²¡åœ¨æ•°æ®åº“ä¸­çš„æ¨¡å‹
// Sync all models that aren&#39;t already in the database
sequelize.sync()

// å¼ºåˆ¶åŒæ­¥æ‰€æœ‰æ•°æ®åº“çš„æ¨¡å‹
sequelize.sync({force: true})

// åˆ é™¤æ‰€æœ‰è¡¨
sequelize.drop()

// å¼€å§‹æ‰§è¡Œ
sequelize.[sync|drop]().then(function() {
  // woot woot
}).catch(function(error) {
  // whooops
})
</code></pre>

<p>å› ä¸º<code>.sync({force: true})</code> æ˜¯æ¯ç­æ€§çš„æ“ä½œ, å¯ä»¥ä½¿ç”¨ match é€‰é¡¹å»å¢åŠ æ›´å¤šçš„å®‰å…¨æ£€æŸ¥(æ­£åˆ™)</p>

<pre><code class="language-js">// åˆ é™¤ä»¥ &#39;_test&#39; ç»“å°¾çš„è¯
sequelize.sync({ force: true, match: /_test$/ });
</code></pre>

<hr/>

<h2 id="toc_12">æ¨¡å‹çš„æ‰©å±•</h2>

<p>Sequelize å…è®¸æˆ‘ä»¬å»ç»™ æ¨¡å‹å’Œç›¸åº”çš„å®ä¾‹ ä¼ é€’å®šåˆ¶æ–¹æ³• </p>

<pre><code class="language-js">var sequelize = new Sequelize(&#39;database&#39;, &#39;username&#39;, &#39;password&#39;, {
  // å…¶ä»–å¯é€‰çš„åˆå§‹åŒ–å¯ä»¥æ”¾åœ¨è¿™é‡Œ
  define: {
    classMethods: {
      method1: function() {},
      method2: function() {}
    },
    instanceMethods: {
      method3: function() {}
    }
  }
})

// Example:
var Foo = sequelize.define(&#39;foo&#39;, { /* attributes */});
Foo.method1()
Foo.method2()
Foo.build().method3()
</code></pre>

<hr/>

<h2 id="toc_13">ç´¢å¼•</h2>

<p>Sequelize æ”¯æŒåœ¨æ¨¡å‹å®šä¹‰ä¸­å¢åŠ ç´¢å¼•, è¿™äº›ç´¢å¼•åœ¨ <code>Model.sync()</code> æˆ– <code>sequelize.sync()</code>æ—¶è¢«åˆ›å»º.</p>

<pre><code class="language-js">sequelize.define(&#39;user&#39;, {}, {
  indexes: [
    // Create a unique index on email
    {
      unique: true,
      fields: [&#39;email&#39;]
    },

    // Creates a gin index on data with the jsonb_path_ops operator
    {
      fields: [&#39;data&#39;],
      using: &#39;gin&#39;,
      operator: &#39;jsonb_path_ops&#39;
    },

    // By default index name will be [table]_[fields]
    // Creates a multi column partial index
    {
      name: &#39;public_by_author&#39;,
      fields: [&#39;author&#39;, &#39;status&#39;],
      where: {
        status: &#39;public&#39;
      }
    },

    // A BTREE index with a ordered field
    {
      name: &#39;title_index&#39;,
      method: &#39;BTREE&#39;,
      fields: [&#39;author&#39;, {attribute: &#39;title&#39;, collate: &#39;en_US&#39;, order: &#39;DESC&#39;, length: 5}]
    }
  ]
})
</code></pre>


    

      </div>

      <div class="row">
        <div class="large-6 columns">
        <p class="text-left" style="padding:15px 0px;">
      
          <a href="14872504904170.html" 
          title="Previous Post: OC(8) å¯¹è±¡åˆå§‹åŒ–">&laquo; OC(8) å¯¹è±¡åˆå§‹åŒ–</a>
      
        </p>
        </div>
        <div class="large-6 columns">
      <p class="text-right" style="padding:15px 0px;">
      
          <a  href="14872504904064.html" 
          title="Next Post: OC(7) å¼‚å¸¸">OC(7) å¼‚å¸¸ &raquo;</a>
      
      </p>
        </div>
      </div>
      <div class="comments-wrap">
        <div class="share-comments">
          

          
            <div id="disqus_thread"></div>
          

          
              <div class="ds-thread" data-thread-key="14872314142360.html" data-url="http://kayorl.com/14872314142360.html" data-title="[è¯‘] Sequelize(2)  å®šä¹‰è¡¨æ ¼"></div>
          
        </div>
      </div>
    </div><!-- article-wrap -->
  </div><!-- large 8 -->




 <div class="large-4 medium-4 columns">
  <div class="hide-for-small">
    <div id="sidebar" class="sidebar">
          <div id="site-info" class="site-info">
            
                <div class="site-a-logo"><img src="http://olh3adg9x.bkt.clouddn.com/logo.jpeg" /></div>
            
                <h1>å‡ è°· åšå®¢</h1>
                <div class="site-des">æš‚æ—¶è¿˜æ²¡æƒ³åˆ°ä»€ä¹ˆ</div>
                <div class="social">









<a target="_blank" class="github" target="_blank" href="https://github.com/kayorl" title="GitHub">GitHub</a>
<a target="_blank" class="email" href="mailto:kayorl@163.com" title="Email">Email</a>
  <a target="_blank" class="rss" href="atom.xml" title="RSS">RSS</a>
                
              	 </div>
          	</div>

             

              <div id="site-categories" class="side-item ">
                <div class="side-header">
                  <h2>Categories</h2>
                </div>
                <div class="side-content">

      	<p class="cat-list">
        
            <a href="nodejs.html"><strong>nodejs</strong></a>
        
            <a href="database.html"><strong>æ•°æ®åº“ç³»ç»Ÿ</strong></a>
        
            <a href="C&C++.html"><strong>C/C++</strong></a>
        
            <a href="O&M.html"><strong>è¿ç»´</strong></a>
        
            <a href="objc.html"><strong>ObjC</strong></a>
         
        </p>


                </div>
              </div>

              <div id="site-categories" class="side-item">
                <div class="side-header">
                  <h2>Recent Posts</h2>
                </div>
                <div class="side-content">
                <ul class="posts-list">
	      
		      
			      <li class="post">
			        <a href="14872445826285.html">MySQL è¯­å¥</a>
			      </li>
		     
		  
		      
			      <li class="post">
			        <a href="14872339187000.html">MySQL5.7 ä»ç›¸è§åˆ°ğŸ‘‹</a>
			      </li>
		     
		  
		      
			      <li class="post">
			        <a href="14872470138156.html">[è¯‘] Sequelize(6) sequelize-cliï¼Œå‡ºé—¨å¿…å¤‡è‰¯å“</a>
			      </li>
		     
		  
		      
			      <li class="post">
			        <a href="14872314142796.html">[è¯‘] Sequelize(5) å‡ å¯¹å‡ </a>
			      </li>
		     
		  
		      
			      <li class="post">
			        <a href="14872314142644.html">[è¯‘] Sequelize(4) èŒƒå›´</a>
			      </li>
		     
		  
		      
		  
		      
		  
		      
		  
		      
		  
		      
		  
		      
		  
		      
		  
		      
		  
		      
		  
		      
		  
		      
		  
		      
		  
		      
		  
		      
		  
		      
		   
		  		</ul>
                </div>
              </div>
        </div><!-- sidebar -->
      </div><!-- hide for small -->
</div><!-- large 4 -->

</div><!-- row -->

 <div class="page-bottom clearfix">
  <div class="row">
   <p class="copyright">Copyright &copy; 2015
Powered by <a target="_blank" href="http://www.mweb.im">MWeb</a>,&nbsp; 
Theme used <a target="_blank" href="http://github.com">GitHub CSS</a>.</p>
  </div>
</div>

        </section>
      </div>
    </div>


<script type="text/javascript">
    var disqus_shortname = 'kayorl'; 

    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>

<script type="text/javascript">
var disqus_shortname = 'kayorl'; 

(function () {
var s = document.createElement('script'); s.async = true;
s.type = 'text/javascript';
s.src = '//' + disqus_shortname + '.disqus.com/count.js';
(document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
}());
</script>
  


<script type="text/javascript">
var duoshuoQuery = {short_name:'kayorl'};
  (function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0] 
     || document.getElementsByTagName('body')[0]).appendChild(ds);
  })();
  </script>
    

    <script src="asset/js/foundation.min.js"></script>
    <script>
      $(document).foundation();
      function fixSidebarHeight(){
        var w1 = $('.markdown-body').height();
          var w2 = $('#sidebar').height();
          if (w1 > w2) { $('#sidebar').height(w1); };
      }
      $(function(){
        fixSidebarHeight();
      })
      $(window).load(function(){
          fixSidebarHeight();
      });
     
    </script>

    <script src="asset/chart/all-min.js"></script><script type="text/javascript">$(function(){    var mwebii=0;    var mwebChartEleId = 'mweb-chart-ele-';    $('pre>code').each(function(){        mwebii++;        var eleiid = mwebChartEleId+mwebii;        if($(this).hasClass('language-sequence')){            var ele = $(this).addClass('nohighlight').parent();            $('<div id="'+eleiid+'"></div>').insertAfter(ele);            ele.hide();            var diagram = Diagram.parse($(this).text());            diagram.drawSVG(eleiid,{theme: 'simple'});        }else if($(this).hasClass('language-flow')){            var ele = $(this).addClass('nohighlight').parent();            $('<div id="'+eleiid+'"></div>').insertAfter(ele);            ele.hide();            var diagram = flowchart.parse($(this).text());            diagram.drawSVG(eleiid);        }    });});</script>



  </body>
</html>
